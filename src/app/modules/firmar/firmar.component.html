<div class="container">
  <!-- Secci贸n para seleccionar usuario y legajo -->
  <div class="card card-outline card-primary mb-3">
    <div class="card-header">
      <h3>Seleccionar Usuario y Legajo</h3>
    </div>
    <div class="card-body">
      <!-- Seleccionar Usuario -->
      <div class="mb-3">
        <label>Seleccionar el usuario para atender:</label>
        <select
          class="form-control"
          [ngModel]="usuarioSeleccionado"
          (ngModelChange)="usuarioSeleccionado = $event; cargarLegajos()"
        >
          <option value="" disabled selected>Seleccione un usuario</option>
          <option *ngFor="let usuario of usuarios" [ngValue]="usuario.idUsuario">
            {{ usuario.nombre }}
            {{ usuario.apePaterno + " " + usuario.apeMaterno }}
          </option>
        </select>
      </div>
      <!-- Seleccionar Legajo -->
      <div class="mb-3">
        <label>Seleccionar Legajo por codigo:</label>
        <select
          class="form-control"
          [(ngModel)]="legajoSeleccionado"
          (change)="cargarDocumentosPorLegajo()"
        >
          <option value="" disabled selected>Seleccione un legajo</option>
          <option *ngFor="let legajo of legajos" [value]="legajo.idlegajo">
            {{ legajo.idlegajo }}
          </option>
          <!-- Puedes cambiar {{ legajo.idlegajo }} por alguna otra propiedad descriptiva del legajo -->
        </select>
      </div>
    </div>
  </div>
  <!-- Secci贸n de Documentos a Fedatar solo se muestra si se ha seleccionado un legajo -->
  <div *ngIf="legajoSeleccionado" class="card card-outline card-primary">
    <div class="card-header text-left">
      <h3>Documentos a Fedatar</h3>
    </div>
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
          <label class="fecha grande">Fecha: {{ fechaHoraActual }}</label>
        </div>
        <div class="d-flex justify-content-center">
          <input
            type="text"
            class="form-control"
            placeholder="Buscar por DNI"
            [(ngModel)]="dniBusqueda"
          />
          <button class="btn btn-success ml-2" (click)="buscarDocumento()">
            <i class="fa-solid fa-magnifying-glass"></i>
          </button>
        </div>
      </div>
      <!-- Envuelve tu tabla con div.table-responsive -->
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>#</th>
              <th>Tipo Documento</th>
              <th>Estado del documento</th> 
              <th>Visualizar</th>
              <th>Observar</th>
              <th>Firmar</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let documento of documentos; let i = index">
              <td>{{ i + 1 }}</td>
              <td>{{ documento.nombreTipoDocumento }}</td>
              <td>{{ documento.estadoActual === 'Creado' ? 'Por revisar' : documento.estadoActual }}</td> <!-- Mostrar el estado ajustado -->
              <td>
                <button
                  type="button"
                  class="btn btn-primary"
                  (click)="visualizar(documento)"
                >
                  <i class="fa-solid fa-binoculars"></i>
                </button>
              </td>
              <td>
                <button
                  type="button"
                  class="btn btn-danger"
                  (click)="iniciarObservacion(documento)"
                >
                  <i class="fa-solid fa-bomb"></i>
                </button>
              </td>
              <td>
                <button class="btn btn-success">
                  <i class="fa-solid fa-signature"></i> Firmar
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal para Visualizar Documento -->
<div
  class="modal fade"
  id="visualizarModal"
  tabindex="-1"
  aria-labelledby="visualizarModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="visualizarModalLabel">
          Visualizar Documento
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <img #imagen class="img-fluid" alt="Documento" />
      </div>
    </div>
  </div>
</div>

<!-- Modal para Observaciones -->
<div
  class="modal fade"
  id="observacionesModal"
  tabindex="-1"
  aria-labelledby="observacionesModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="observacionesModalLabel">
          Registrar Observaciones
        </h5>
        <button
          type="button"
          (click)="cerrarModal()"
          class="close"
          data-dismiss="modal"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form>
          <div *ngFor="let observacion of observacionesActuales; let i = index">
            <select
              class="form-select"
              [(ngModel)]="observacion.idobservaciones"
              name="tipoObservacion{{ i }}"
            >
              <option value="null" disabled>
                Seleccione el tipo de Observacion
              </option>
              <option
                *ngFor="let obs of observaciones"
                [ngValue]="obs.idobservaciones"
              >
                {{ obs.descripcion }}
              </option>
            </select>
            <textarea
              class="form-control mt-3"
              rows="3"
              [(ngModel)]="observacion.sugerencias"
              name="detalleObservacion{{ i }}"
              placeholder="Detalle de la observaci贸n"
            ></textarea>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary mt-3"
              (click)="agregarNuevaObservacion()"
            >
              Agregar Otra Observaci贸n
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
              (click)="cerrarModal()"
            >
              Cerrar
            </button>
            <button
              type="button"
              class="btn btn-primary"
              (click)="registrarObservaciones(documentoActual)"
            >
              Registrar Observaciones
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Modal para visualizar documentos -->
<div
  class="modal fade"
  id="visualizarDocumentoModal"
  tabindex="-1"
  role="dialog"
  aria-labelledby="visualizarDocumentoModalLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="visualizarDocumentoModalLabel">
          Visualizar Documento
        </h5>
        <button
          type="button"
          class="close"
          data-dismiss="modal"
          (click)="cerrarModal()"
          aria-label="Close"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <iframe [src]="documentoUrl" width="100%" height="600px"></iframe>
      </div>
    </div>
  </div>
</div>
